name: MONITOR
label: "Monitor"
description: "集齐Promethus、Alermanager、Node Exporter和Grafana一体的监控告警服务"
version: 1.0.0
dockerImage: "registry.mufankong.top/udh/monitor:1.0.0"
dependencies:

runAs: root

supportKerberos: false

persistencePaths:
  - /opt/udh/${serviceInstanceId}/conf
  - /opt/udh/${serviceInstanceId}/log
  - /opt/udh/${serviceInstanceId}/data
  - /opt/udh/${serviceInstanceId}/grafana/data
  - /opt/udh/${serviceInstanceId}/prometheus/data
  - /opt/udh/${serviceInstanceId}/alertmanager/data
  - /opt/udh/${serviceInstanceId}/nodeexporter/data


roles:
  - name: MONITOR_PROMETHUS
    label: prometheus
    roleFullName: monitor-prometheus
    linkExpression: "http://${localhostname}:${conf['nodemanager.webapp.port']}/node/allApplications/?user.name=yarn"
    sortNum: 1
    type: MASTER
    jmxPort: 9232
    fixedNum: 1



  - name: MONITOR_ALERTMANAGER
    label: "Alert Manager"
    roleFullName: monitor-alert-manager
    linkExpression: "http://${localhostname}:${conf['historyserver.http-port']}"
    sortNum: 2
    type: MASTER
    jmxPort: 9232
    fixedNum: 1

  - name: MONITOR_NODEEXPORTER
    label: "Node Exporter"
    roleFullName: monitor-node-exporter
    linkExpression: "http://${localhostname}:${conf['historyserver.http-port']}"
    sortNum: 3
    type: SLAVE
    jmxPort: 9232
    minNum: 1

  - name: MONITOR_GRAFANA
    label: Grafana
    roleFullName: monitor-grafana
    linkExpression: "http://${localhostname}:${conf['resourcemanager.webapp.port']}/?user.name=yarn"
    sortNum: 4
    type: MASTER
    jmxPort: 9232
    fixedNum: 1





customConfigFiles: []



configurations:
  - name: prometheus.http.port
    recommendExpression: 9090
    valueType: InputNumber
    configurableInWizard: true
  - name: nodeexporter.http.port
    recommendExpression: 9100
    valueType: InputNumber
    configurableInWizard: true
  - name: alertmanager.http.port
    recommendExpression: 9093
    valueType: InputNumber
    configurableInWizard: true
  - name: grafana.http.port
    recommendExpression: 3000
    valueType: InputNumber
    configurableInWizard: true



